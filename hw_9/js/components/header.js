import { getState } from '../state.js';
import { logout, isLoggedIn } from '../auth.js';
import { navigateTo } from '../router.js';

export const renderHeader = (options = {}) => {
    const header = document.getElementById('header');
    const { user, profileImage } = getState();
    const { showHeader = true } = options;
    //const profileImage = user?.profileImage;
    console.log("renderHeader");
    header.innerHTML = `
        ${showHeader ? `
            <div class="custom-header">
                <div class="container header-content">
                    <div style="width: 40px"></div>
                    <!-- 로고 -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="275" height="80" viewBox="0 0 275 233" fill="none">
                        <path d="M73.26 232.878C68.228 232.878 63.566 231.102 59.274 227.55C54.982 223.998 52.022 219.484 50.394 214.008C49.802 211.936 49.358 209.716 49.062 207.348C48.914 205.128 48.84 202.76 48.84 200.244C48.84 192.252 49.876 183.15 51.948 172.938C54.168 162.726 56.98 151.922 60.384 140.526C63.936 128.982 67.784 117.438 71.928 105.894C76.22 94.202 80.364 82.954 84.36 72.15C88.504 61.198 92.278 51.134 95.682 41.958C99.086 32.634 101.75 24.79 103.674 18.426C104.71 15.17 105.228 12.506 105.228 10.434C105.228 7.77001 104.34 6.43801 102.564 6.43801C100.344 6.43801 96.94 8.58401 92.352 12.876C87.764 17.168 82.51 23.014 76.59 30.414C70.67 37.814 64.528 46.398 58.164 56.166C51.8 65.934 45.732 76.294 39.96 87.246C34.188 98.198 29.156 109.298 24.864 120.546C20.572 131.794 17.464 142.672 15.54 153.18C15.392 154.216 15.244 155.844 15.096 158.064C14.948 160.284 14.578 162.282 13.986 164.058C13.542 165.834 12.58 166.722 11.1 166.722C7.84403 166.574 5.55003 164.946 4.21803 161.838C3.03403 158.73 2.22003 155.844 1.77603 153.18C0.592027 145.336 2.67774e-05 136.16 2.67774e-05 125.652C2.67774e-05 117.216 0.370027 108.484 1.11003 99.456C1.85003 90.428 2.88603 81.844 4.21803 73.704C5.55003 65.564 7.10403 58.682 8.88003 53.058C10.064 49.506 11.692 46.324 13.764 43.512C15.984 40.552 17.982 39.072 19.758 39.072C20.794 39.072 21.608 39.812 22.2 41.292C22.94 42.772 23.236 45.436 23.088 49.284C23.088 50.912 22.348 54.02 20.868 58.608C19.536 63.048 17.908 68.82 15.984 75.924C14.208 83.028 12.654 91.242 11.322 100.566C9.99003 109.89 9.32403 120.176 9.32403 131.424C9.32403 136.752 9.54603 142.302 9.99003 148.074C11.322 143.93 13.32 138.158 15.984 130.758C18.796 123.358 22.2 114.996 26.196 105.672C30.34 96.348 34.928 86.728 39.96 76.812C45.14 66.748 50.69 56.98 56.61 47.508C62.53 38.036 68.746 29.452 75.258 21.756C81.77 14.06 88.43 7.91801 95.238 3.33001C98.642 1.11001 102.194 1.50204e-05 105.894 1.50204e-05C109.89 1.50204e-05 113.294 1.25801 116.106 3.77401C119.066 6.29001 120.398 9.84201 120.102 14.43C119.806 20.646 118.252 26.936 115.44 33.3C112.776 39.516 109.594 45.584 105.894 51.504C102.342 57.424 99.012 63.122 95.904 68.598C91.612 76.442 87.246 85.174 82.806 94.794C78.514 104.414 74.518 114.478 70.818 124.986C67.266 135.494 64.38 146.076 62.16 156.732C59.94 167.388 58.83 177.674 58.83 187.59C58.83 195.878 59.866 203.944 61.938 211.788C63.566 217.56 65.564 221.556 67.932 223.776C70.448 225.996 72.89 227.106 75.258 227.106C77.922 227.106 80.364 226.366 82.584 224.886C84.952 223.406 86.802 221.778 88.134 220.002C89.614 218.374 90.28 217.412 90.132 217.116C90.428 216.968 90.724 216.894 91.02 216.894C92.056 216.894 92.278 217.56 91.686 218.892C91.242 220.372 90.576 221.852 89.688 223.332C88.8 224.96 88.134 225.996 87.69 226.44C85.47 228.66 83.102 230.288 80.586 231.324C78.218 232.36 75.776 232.878 73.26 232.878ZM118.411 181.152C113.527 181.152 109.531 179.672 106.423 176.712C103.463 173.752 101.243 169.978 99.763 165.39C98.283 160.654 97.543 155.696 97.543 150.516C97.543 147.408 97.839 144.448 98.431 141.636C99.023 138.824 99.615 136.53 100.207 134.754C100.059 133.718 99.911 132.682 99.763 131.646C99.763 130.462 99.763 129.278 99.763 128.094C99.763 123.802 100.207 119.14 101.095 114.108C101.983 109.076 103.389 104.266 105.313 99.678C107.385 95.09 109.901 91.39 112.861 88.578C115.969 85.618 119.743 84.138 124.183 84.138C128.031 84.138 131.805 85.766 135.505 89.022C139.205 92.13 142.461 96.718 145.273 102.786C146.901 106.19 148.011 109.89 148.603 113.886C149.343 117.734 149.713 121.656 149.713 125.652C149.713 131.128 149.121 136.604 147.937 142.08C146.901 147.408 145.347 152.44 143.275 157.176C141.795 160.58 139.797 164.206 137.281 168.054C134.913 171.754 132.175 174.862 129.067 177.378C125.959 179.894 122.407 181.152 118.411 181.152ZM119.521 176.268C124.553 176.268 129.215 172.79 133.507 165.834C136.615 160.95 138.835 155.4 140.167 149.184C141.499 142.82 142.165 136.456 142.165 130.092C142.165 125.356 141.869 120.768 141.277 116.328C140.685 111.888 139.797 107.596 138.613 103.452C137.577 99.752 135.801 96.496 133.285 93.684C130.917 90.724 127.513 89.466 123.073 89.91C119.521 90.206 116.413 91.982 113.749 95.238C111.085 98.494 109.013 102.194 107.533 106.338C106.201 110.334 105.535 113.812 105.535 116.772C105.535 118.4 105.757 119.658 106.201 120.546C106.645 119.362 107.755 117.438 109.531 114.774C111.307 111.962 113.305 109.446 115.525 107.226C117.745 104.858 119.817 103.674 121.741 103.674C123.369 103.674 124.183 104.34 124.183 105.672C122.259 105.82 120.335 107.004 118.411 109.224C116.635 111.296 114.933 113.812 113.305 116.772C111.825 119.732 110.567 122.692 109.531 125.652C108.643 128.464 107.977 130.684 107.533 132.312C107.385 132.904 107.163 133.644 106.867 134.532C106.571 135.42 106.423 136.308 106.423 137.196C106.423 138.232 107.015 139.934 108.199 142.302C109.383 144.522 111.307 146.594 113.971 148.518C116.635 150.442 120.261 151.404 124.849 151.404C126.181 151.404 127.587 151.256 129.067 150.96C130.547 150.664 131.953 150.368 133.285 150.072L134.839 149.628C135.135 149.628 135.283 149.776 135.283 150.072C135.283 150.516 134.765 151.108 133.729 151.848C132.841 152.44 132.027 152.884 131.287 153.18C129.215 154.216 126.921 154.734 124.405 154.734C120.705 154.734 117.153 153.624 113.749 151.404C110.493 149.036 107.607 146.372 105.091 143.412C104.943 144.596 104.869 145.78 104.869 146.964C104.869 148 104.869 149.036 104.869 150.072C104.869 158.656 106.349 165.168 109.309 169.608C112.269 174.048 115.673 176.268 119.521 176.268ZM164.245 183.816C160.693 183.816 158.029 182.262 156.253 179.154C154.477 176.194 153.589 172.42 153.589 167.832C153.589 164.576 154.255 160.506 155.587 155.622C156.919 150.738 158.769 145.632 161.137 140.304C163.505 134.976 166.169 130.018 169.129 125.43C172.089 120.694 175.123 116.92 178.231 114.108C181.487 111.148 184.669 109.668 187.777 109.668C190.293 109.668 192.069 110.63 193.105 112.554C194.289 114.33 194.881 116.254 194.881 118.326C194.881 120.102 194.511 121.73 193.771 123.21C193.179 124.542 192.291 125.208 191.107 125.208C189.923 125.208 189.035 124.69 188.443 123.654C187.999 122.47 187.555 121.286 187.111 120.102C186.815 118.918 186.001 118.326 184.669 118.326C182.005 118.326 179.341 120.028 176.677 123.432C174.013 126.836 171.571 131.128 169.351 136.308C167.131 141.488 165.355 146.89 164.023 152.514C162.691 157.99 162.025 162.874 162.025 167.166C162.025 170.274 162.395 172.716 163.135 174.492C164.023 176.416 165.429 177.378 167.353 177.378C169.869 177.378 172.385 175.824 174.901 172.716C177.565 169.46 180.155 165.316 182.671 160.284C185.187 155.104 187.481 149.702 189.553 144.078C191.773 138.454 193.623 133.2 195.103 128.316C196.731 123.284 197.989 119.288 198.877 116.328C200.061 105.968 201.467 95.534 203.095 85.026C204.871 74.518 207.461 64.306 210.865 54.39C211.309 52.762 211.975 51.356 212.863 50.172C213.899 48.988 214.935 48.396 215.971 48.396C217.155 48.396 218.117 49.21 218.857 50.838C219.745 52.466 220.189 54.316 220.189 56.388C220.189 58.016 219.893 59.718 219.301 61.494C218.709 63.27 217.969 65.638 217.081 68.598C216.045 72.15 214.713 76.886 213.085 82.806C211.605 88.578 210.051 95.164 208.423 102.564C206.795 109.816 205.389 117.586 204.205 125.874C203.169 134.014 202.651 142.154 202.651 150.294C202.651 156.51 203.095 160.876 203.983 163.392C204.871 165.908 206.055 167.166 207.535 167.166C209.163 167.166 210.939 166.13 212.863 164.058C214.935 161.986 216.933 159.47 218.857 156.51C220.929 153.55 222.779 150.59 224.407 147.63C226.035 144.522 227.293 142.08 228.181 140.304C229.809 137.048 231.067 135.42 231.955 135.42C232.547 135.42 232.843 136.086 232.843 137.418C232.843 138.454 232.621 139.564 232.177 140.748C231.289 142.672 230.697 144.152 230.401 145.188C230.105 146.076 229.735 146.964 229.291 147.852C228.995 148.74 228.255 150.146 227.071 152.07C226.035 153.846 224.407 156.288 222.187 159.396C219.967 162.356 217.451 165.094 214.639 167.61C211.827 169.978 209.015 171.162 206.203 171.162C203.391 171.162 201.245 169.978 199.765 167.61C198.433 165.242 197.545 162.208 197.101 158.508C196.805 154.66 196.657 150.738 196.657 146.742C196.657 141.858 196.879 136.678 197.323 131.202C196.287 134.754 194.881 138.972 193.105 143.856C191.329 148.592 189.331 153.402 187.111 158.286C184.891 163.17 182.523 167.61 180.007 171.606C177.935 174.862 175.641 177.674 173.125 180.042C170.609 182.558 167.649 183.816 164.245 183.816ZM243.234 176.268C237.906 176.268 233.244 173.16 229.248 166.944C225.4 160.58 223.476 150.59 223.476 136.974C223.476 128.094 224.586 120.99 226.806 115.662C229.026 110.186 231.764 106.19 235.02 103.674C238.276 101.158 241.384 99.9 244.344 99.9C247.304 99.9 249.82 100.936 251.892 103.008C253.964 104.932 255 107.744 255 111.444C255 114.996 253.964 118.77 251.892 122.766C249.82 126.614 247.304 130.166 244.344 133.422C241.532 136.53 238.72 138.602 235.908 139.638C235.316 139.934 234.576 140.082 233.688 140.082C233.096 140.082 232.8 139.86 232.8 139.416C232.8 138.232 233.984 136.9 236.352 135.42C239.312 133.348 242.124 130.24 244.788 126.096C247.452 121.804 248.784 118.03 248.784 114.774C248.784 112.85 248.34 111.37 247.452 110.334C246.564 109.15 245.528 108.558 244.344 108.558C242.124 108.558 239.682 110.334 237.018 113.886C234.502 117.29 232.652 123.21 231.468 131.646C231.172 134.014 230.876 136.308 230.58 138.528C230.432 140.6 230.358 142.672 230.358 144.744C230.358 153.032 231.616 159.544 234.132 164.28C236.648 168.868 239.978 171.162 244.122 171.162C247.674 171.162 251.67 169.09 256.11 164.946C260.55 160.654 264.916 153.994 269.208 144.966C270.244 142.598 271.428 141.414 272.76 141.414C273.648 141.414 274.092 142.006 274.092 143.19C274.092 144.226 273.796 145.336 273.204 146.52C269.356 155.992 264.694 163.318 259.218 168.498C253.742 173.678 248.414 176.268 243.234 176.268Z" fill="#2B2B2B"/>
                    </svg>
                    ${isLoggedIn() ? `
                        <div class="profile-menu">
                            <button class="profile-btn" id="profileBtn">
                                ${profileImage ? `
                                    <img src="${profileImage}" alt="프로필" class="profile-image">
                                ` : `
                                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40" fill="none">
                                        <rect width="40" height="40" rx="20" fill="#2b2b2b"/>
                                        <circle cx="20.197" cy="11.9212" r="6.00985" fill="white"/>
                                        <path d="M31.5271 32.0197C31.5271 30.48 31.2315 28.9555 30.6571 27.533C30.0828 26.1106 29.241 24.8181 28.1797 23.7295C27.1185 22.6408 25.8586 21.7772 24.472 21.188C23.0854 20.5988 21.5993 20.2955 20.0985 20.2955C18.5977 20.2955 17.1115 20.5988 15.725 21.188C14.3384 21.7772 13.0785 22.6408 12.0173 23.7295C10.956 24.8181 10.1142 26.1106 9.53987 27.533C8.96553 28.9555 8.66992 30.48 8.66992 32.0197L20 32L31.5271 32.0197Z" fill="white"/>
                                    </svg>
                                `}
                            </button>
                            
                            <!-- 드롭다운 메뉴 -->
                            <div class="dropdown-menu" id="dropdownMenu">
                                <a href="/profile" data-link class="dropdown-item">
                                    회원정보수정
                                </a>
                                <a href="/password/edit" data-link class="dropdown-item">
                                    비밀번호수정
                                </a>
                                <button class="dropdown-item" id="logoutBtn">
                                    로그아웃
                                </button>
                            </div>
                        </div>
                    ` : '<div style="width: 40px"></div>'}
                </div>
            </div>
        ` : ``}
        
    `;

    // 프로필 버튼 (드롭다운 토글)
    if (isLoggedIn()) {
        const profileBtn = document.getElementById('profileBtn');
        const dropdownMenu = document.getElementById('dropdownMenu');
        
        profileBtn?.addEventListener('click', (e) => {
            e.stopPropagation();
            dropdownMenu.classList.toggle('show');
        });
        /*
        // 외부 클릭 시 드롭다운 닫기
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.profile-menu')) {
                dropdownMenu?.classList.remove('show');
            }
        });
        */
        
        // 로그아웃 버튼
        document.getElementById('logoutBtn')?.addEventListener('click', () => {
            if (confirm('로그아웃 하시겠습니까?')) {
                logout();
                navigateTo('/login');
            }
        });
    }
};
